<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöê Monitor Victron PRO - Siena395</title>
    </head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">üöê Siena395 Dashboard</span>
            <div id="connection-badge" class="badge bg-danger">
                <i class="fas fa-plug"></i> <span id="status-text">Desconectado</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row g-3">
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body text-center">
                        <h6 class="text-muted mb-2">BATER√çA PRINCIPAL</h6>
                        <h2 id="bat-volts">--.- V</h2>
                        <div class="progress mt-3" style="height: 10px;">
                            <div id="bat-soc-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small id="bat-soc-text" class="text-muted">Carga: --%</small>
                    </div>
                </div>
            </div>
            </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-sm p-3">
                    <canvas id="voltageChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
// Funci√≥n corregida para evitar errores de "null" y tildes
function updateConnectionStatus(connected, ip = '') {
    const badge = document.getElementById('connection-badge');
    const text = document.getElementById('status-text');
    
    if (badge && text) {
        if (connected) {
            badge.className = 'badge bg-success';
            text.textContent = 'Conectado: ' + ip;
        } else {
            badge.className = 'badge bg-danger';
            text.textContent = 'Buscando dispositivo...';
        }
    }
}

// Actualizaci√≥n de valores en pantalla
function updateUI(data) {
    const elements = {
        'bat-volts': data.voltage ? data.voltage.toFixed(2) + ' V' : '--.- V',
        'bat-soc-text': data.soc ? 'Carga: ' + data.soc + '%' : 'Carga: --%',
        'prod-sol': data.power ? data.power + ' W' : '0 W'
    };

    for (const [id, val] of Object.entries(elements)) {
        const el = document.getElementById(id);
        if (el) el.textContent = val;
    }
    
    // Actualizar barra de progreso si existe
    const bar = document.getElementById('bat-soc-bar');
    if (bar && data.soc) bar.style.width = data.soc + '%';
}
let voltageChart = null;

document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('voltageChart');
    
    if (ctx) {
        voltageChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Voltaje Bater√≠a (V)',
                    data: [],
                    borderColor: '#667eea',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        console.log('‚úÖ Gr√°fico inicializado correctamente');
    } else {
        console.error('‚ùå No se encontr√≥ el elemento canvas #voltageChart');
    }

    // Iniciar el resto de funciones
    manualIPDiscovery(); 
});
