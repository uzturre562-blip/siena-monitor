<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA LOGS - CONSOLA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #f8f5f0;
            --bg-secondary: #fefcf8;
            --text-main: #2c2925;
            --accent-primary: #8b7355;
            --victron-blue: #1a5c96;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --card-radius: 24px;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-main); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        .nav-master { display: flex; justify-content: center; gap: 10px; padding: 12px; background: var(--bg-secondary); border-bottom: 1px solid #e2ddd5; }
        .nav-btn { background: var(--bg-primary); border: 2px solid #e2ddd5; padding: 8px 12px; border-radius: 12px; font-weight: 700; color: #666; text-decoration: none; font-size: 0.8rem; }
        .nav-btn.active { background: #333; color: white; border-color: #333; }

        .log-container { flex: 1; margin: 15px; background: #1e1e1e; border-radius: 20px; padding: 15px; box-shadow: inset 0 4px 20px rgba(0,0,0,0.5); display: flex; flex-direction: column; overflow: hidden; }
        
        #log-console { flex: 1; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.85rem; color: #d4d4d4; line-height: 1.4; padding-right: 10px; }
        
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .timestamp { color: #888; font-size: 0.75rem; margin-right: 8px; }
        .topic { color: var(--accent-secondary); font-weight: bold; margin-right: 8px; }
        .msg-info { color: var(--success); }
        .msg-warn { color: var(--warning); }

        .controls { display: flex; gap: 10px; margin-top: 10px; }
        .control-btn { flex: 1; background: #333; color: white; border: none; padding: 10px; border-radius: 10px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .control-btn:active { transform: scale(0.98); }
        /* --- VARIABLES MODO OSCURO --- */
body.dark-mode {
    --bg-primary: #121417;       /* Fondo muy oscuro */
    --bg-secondary: #1a1d23;     /* Fondo de tarjetas */
    --bg-tertiary: #252a33;      /* Contrastes */
    --text-main: #e0e0e0;        /* Texto claro */
    --accent-secondary: #4a4a4a; /* Bordes oscuros */
    border-color: #333;
}

/* Ajustes específicos para que las tarjetas se vean bien en oscuro */
body.dark-mode .card, 
body.dark-mode .nav-master, 
body.dark-mode .v-item, 
body.dark-mode .cell-item {
    background: var(--bg-secondary);
    border: 1px solid #2d343f;
    color: var(--text-main);
}

body.dark-mode .nav-btn {
    background: #252a33;
    color: #aaa;
    border-color: #3d4450;
}

/* Botón flotante para cambiar el modo */
.theme-switch {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--accent-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    z-index: 2000;
    border: none;
}
    </style>
</head>
<body>

    <nav class="nav-master">
        <a href="index.html" class="nav-btn">INICIO</a>
        <a href="victron.html" class="nav-btn">VICTRON</a>
        <a href="bateria.html" class="nav-btn">BATERÍA</a>
        <a href="logs.html" class="nav-btn active">LOGS</a>
    </nav>

    <div class="log-container">
        <div id="log-console">
            <div class="log-entry"><span class="timestamp">--:--:--</span> <span class="msg-info">Esperando datos del monitor...</span></div>
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="clearLogs()"><i class="fas fa-trash"></i> LIMPIAR</button>
            <button class="control-btn" id="pauseBtn" onclick="togglePause()"><i class="fas fa-pause"></i> PAUSAR</button>
        </div>
    </div>

    <script>
        const BROKER = 'wss://broker.hivemq.com:8884/mqtt';
        const TOPIC_PREFIX = 'siena395_monitor_mikel_2026';
        let isPaused = false;
        const consoleEl = document.getElementById('log-console');

        const client = mqtt.connect(BROKER);

        client.on('connect', () => {
            addEntry('SISTEMA', 'Conectado al Broker HiveMQ', 'msg-info');
            client.subscribe(`${TOPIC_PREFIX}/#`);
        });

        client.on('message', (topic, message) => {
            if (isPaused) return;
            
            // Simplificamos el nombre del topic para que no ocupe tanto
            const shortTopic = topic.replace(TOPIC_PREFIX + '/', '');
            addEntry(shortTopic, message.toString());
        });

        function addEntry(topic, msg, className = '') {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0') + ':' + 
                          now.getSeconds().toString().padStart(2, '0');
            
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerHTML = `<span class="timestamp">[${timeStr}]</span><span class="topic">${topic}:</span><span class="${className}">${msg}</span>`;
            
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight; // Auto-scroll
        }

        function clearLogs() {
            consoleEl.innerHTML = '<div class="log-entry"><span class="timestamp">--:--:--</span> <span class="msg-info">Consola limpia.</span></div>';
        }

        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.innerHTML = isPaused ? '<i class="fas fa-play"></i> REANUDAR' : '<i class="fas fa-pause"></i> PAUSAR';
            btn.style.background = isPaused ? 'var(--success)' : '#333';
        }
    </script>
</body>
</html>
